<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ICAIR 2025 - Get Your DP</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: #5e17eb;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 24px;
        box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
        max-width: 650px;
        width: 100%;
        padding: 50px;
        text-align: center;
      }

      h1 {
        color: #5e17eb;
        margin-bottom: 12px;
        font-size: 3em;
        font-weight: 700;
        letter-spacing: -1px;
      }

      .subtitle {
        color: #64748b;
        margin-bottom: 40px;
        font-size: 1.15em;
        font-weight: 400;
      }

      .input-group {
        margin-bottom: 24px;
        text-align: left;
      }

      .input-group label {
        display: block;
        color: #5e17eb;
        font-weight: 600;
        margin-bottom: 8px;
        font-size: 0.95em;
      }

      .input-group input[type="text"] {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        font-size: 1em;
        transition: all 0.2s ease;
        font-family: inherit;
      }

      .input-group input[type="text"]:focus {
        outline: none;
        border-color: #5e17eb;
        box-shadow: 0 0 0 3px rgba(94, 23, 235, 0.1);
      }

      .input-group input[type="text"]::placeholder {
        color: #94a3b8;
      }

      .upload-area {
        border: 3px dashed #5e17eb;
        border-radius: 20px;
        padding: 50px 30px;
        margin-bottom: 30px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: #faf5ff;
      }

      .upload-area:hover {
        border-color: #4a0fc7;
        background: #f3e8ff;
        transform: translateY(-2px);
      }

      .upload-area.dragover {
        border-color: #4a0fc7;
        background: #ede9fe;
        transform: scale(1.02);
        box-shadow: 0 8px 24px rgba(94, 23, 235, 0.15);
      }

      .upload-icon {
        font-size: 4.5em;
        margin-bottom: 20px;
        filter: grayscale(100%);
        opacity: 0.7;
      }

      .upload-text {
        color: #5e17eb;
        font-size: 1.25em;
        margin-bottom: 12px;
        font-weight: 600;
      }

      .upload-hint {
        color: #94a3b8;
        font-size: 0.95em;
      }

      #fileInput {
        display: none;
      }

      .preview-container {
        display: none;
        margin-bottom: 30px;
        animation: fadeIn 0.4s ease-in;
      }

      .preview-container.show {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      #previewImage {
        max-width: 100%;
        border-radius: 16px;
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
      }

      .button-group {
        margin-top: 24px;
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .button {
        background: #5e17eb;
        color: white;
        border: none;
        padding: 16px 36px;
        border-radius: 12px;
        font-size: 1.05em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-block;
      }

      .button:hover {
        background: #4a0fc7;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(94, 23, 235, 0.3);
      }

      .button:active {
        transform: translateY(0);
      }

      .button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .button-secondary {
        background: #64748b;
      }

      .button-secondary:hover {
        background: #475569;
        box-shadow: 0 8px 20px rgba(100, 116, 139, 0.3);
      }

      .loading {
        display: none;
        margin: 30px 0;
      }

      .loading.show {
        display: block;
      }

      .spinner {
        border: 4px solid #ede9fe;
        border-top: 4px solid #5e17eb;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        animation: spin 0.8s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        margin-top: 20px;
        color: #5e17eb;
        font-weight: 500;
      }

      .error-message {
        display: none;
        background: #fee2e2;
        color: #991b1b;
        padding: 16px 20px;
        border-radius: 12px;
        margin-bottom: 24px;
        border: 1px solid #fecaca;
      }

      .error-message.show {
        display: block;
        animation: fadeIn 0.3s ease-in;
      }

      .share-section {
        margin-top: 32px;
        padding-top: 24px;
        border-top: 2px solid #f1f5f9;
      }

      .share-title {
        color: #64748b;
        font-size: 0.95em;
        margin-bottom: 16px;
        font-weight: 500;
      }

      .share-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .share-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        border: none;
        border-radius: 10px;
        font-size: 0.95em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        color: white;
      }

      .share-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
      }

      .share-btn.twitter {
        background: #000000;
      }

      .share-btn.linkedin {
        background: #0077b5;
      }

      .share-btn.instagram {
        background: linear-gradient(
          45deg,
          #f09433 0%,
          #e6683c 25%,
          #dc2743 50%,
          #cc2366 75%,
          #bc1888 100%
        );
      }

      /* Custom Alert Dialog Styles */
      .custom-alert-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        z-index: 9999;
        animation: overlayFadeIn 0.2s ease-out;
      }

      .custom-alert-overlay.show {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      @keyframes overlayFadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .custom-alert {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 480px;
        width: 100%;
        padding: 0;
        animation: alertSlideIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        overflow: hidden;
      }

      @keyframes alertSlideIn {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .custom-alert-header {
        padding: 28px 28px 20px 28px;
        text-align: center;
        border-bottom: 1px solid #f1f5f9;
      }

      .custom-alert-icon {
        font-size: 3em;
        margin-bottom: 12px;
        line-height: 1;
      }

      .custom-alert-title {
        font-size: 1.4em;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 8px;
      }

      .custom-alert-body {
        padding: 24px 28px;
        text-align: left;
      }

      .custom-alert-message {
        color: #475569;
        line-height: 1.6;
        font-size: 1em;
      }

      .custom-alert-steps {
        margin-top: 16px;
        padding: 16px;
        background: #f8fafc;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
      }

      .custom-alert-step {
        display: flex;
        align-items: flex-start;
        margin-bottom: 12px;
        gap: 12px;
      }

      .custom-alert-step:last-child {
        margin-bottom: 0;
      }

      .custom-alert-step-number {
        background: #5e17eb;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.85em;
        font-weight: 600;
        flex-shrink: 0;
      }

      .custom-alert-step-text {
        color: #334155;
        line-height: 1.5;
        font-size: 0.95em;
        padding-top: 2px;
      }

      .custom-alert-footer {
        padding: 20px 28px 28px 28px;
        display: flex;
        gap: 12px;
        justify-content: center;
      }

      .custom-alert-button {
        background: #5e17eb;
        color: white;
        border: none;
        padding: 14px 32px;
        border-radius: 10px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: inherit;
      }

      .custom-alert-button:hover {
        background: #4a0fc7;
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(94, 23, 235, 0.3);
      }

      .custom-alert-button:active {
        transform: translateY(0);
      }

      .success-checkmark {
        color: #10b981;
      }

      .info-icon {
        color: #3b82f6;
      }

      .footer {
        margin-top: 40px;
        color: #94a3b8;
        font-size: 0.9em;
        line-height: 1.6;
      }

      .footer p {
        margin: 4px 0;
      }

      @media (max-width: 640px) {
        .container {
          padding: 30px 20px;
        }

        h1 {
          font-size: 2.2em;
        }

        .upload-area {
          padding: 40px 20px;
        }

        .button-group {
          flex-direction: column;
        }

        .button {
          width: 100%;
        }

        .share-buttons {
          flex-direction: column;
        }

        .share-btn {
          width: 100%;
          justify-content: center;
        }

        .custom-alert {
          max-width: 100%;
          margin: 20px;
        }

        .custom-alert-header {
          padding: 24px 20px 16px 20px;
        }

        .custom-alert-body {
          padding: 20px;
        }

        .custom-alert-footer {
          padding: 16px 20px 24px 20px;
          flex-direction: column;
        }

        .custom-alert-button {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 id="pageTitle">ICAIR 2025</h1>
      <p class="subtitle" id="pageSubtitle">
        Generate your conference profile picture
      </p>

      <div class="error-message" id="errorMessage"></div>

      <div class="input-group">
        <label for="usernameInput"
          >Name <span style="color: #dc2626">*</span></label
        >
        <input
          type="text"
          id="usernameInput"
          placeholder="Enter your name"
          maxlength="30"
          required
        />
      </div>

      <div class="upload-area" id="uploadArea">
        <div class="upload-icon">&#128247;</div>
        <div class="upload-text">Click to upload or drag and drop</div>
        <div class="upload-hint">PNG, JPG up to 16MB</div>
      </div>

      <input type="file" id="fileInput" accept="image/*,.heic,.heif" />

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p class="loading-text">Processing your image...</p>
      </div>

      <div class="preview-container" id="previewContainer">
        <img id="previewImage" alt="Generated DP" />
        <div class="button-group">
          <button class="button" id="downloadBtn">Download Image</button>
          <button class="button button-secondary" id="resetBtn">
            Upload Another
          </button>
        </div>
        <div class="share-section">
          <p class="share-title">Share to:</p>
          <div class="share-buttons">
            <button class="share-btn twitter" id="shareTwitter">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"
                />
              </svg>
              Twitter
            </button>
            <button class="share-btn linkedin" id="shareLinkedIn">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
                />
              </svg>
              LinkedIn
            </button>
            <button class="share-btn instagram" id="shareInstagram">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"
                />
              </svg>
              Instagram
            </button>
          </div>
        </div>
      </div>

      <div class="footer">
        <p>
          5th International Conference on Artificial Intelligence and Robotics
        </p>
        <p>November 4-6, 2025 | University of Lagos</p>
      </div>
    </div>

    <!-- Custom Alert Dialog -->
    <div class="custom-alert-overlay" id="customAlertOverlay">
      <div class="custom-alert">
        <div class="custom-alert-header">
          <div class="custom-alert-icon" id="customAlertIcon">✓</div>
          <h3 class="custom-alert-title" id="customAlertTitle">Success!</h3>
        </div>
        <div class="custom-alert-body">
          <p class="custom-alert-message" id="customAlertMessage"></p>
          <div
            class="custom-alert-steps"
            id="customAlertSteps"
            style="display: none"
          ></div>
        </div>
        <div class="custom-alert-footer">
          <button class="custom-alert-button" id="customAlertButton">
            Got it!
          </button>
        </div>
      </div>
    </div>

    <script>
      const uploadArea = document.getElementById("uploadArea");
      const fileInput = document.getElementById("fileInput");
      const usernameInput = document.getElementById("usernameInput");
      const previewContainer = document.getElementById("previewContainer");
      const previewImage = document.getElementById("previewImage");
      const downloadBtn = document.getElementById("downloadBtn");
      const resetBtn = document.getElementById("resetBtn");
      const loading = document.getElementById("loading");
      const errorMessage = document.getElementById("errorMessage");

      const SHARE_TEXT =
        "I'm excited to announce that I will be attending the 5th International Conference on AI and Robotics happening on Nov 4-6 at UNILAG.\n\nRegister today: https://icair.unilag.edu.ng/\n\n#icair2025";
      const SHARE_URL = "https://icair.unilag.edu.ng/";

      // Custom Alert Dialog Functions
      function showCustomAlert(options) {
        const overlay = document.getElementById("customAlertOverlay");
        const icon = document.getElementById("customAlertIcon");
        const title = document.getElementById("customAlertTitle");
        const message = document.getElementById("customAlertMessage");
        const stepsContainer = document.getElementById("customAlertSteps");
        const button = document.getElementById("customAlertButton");

        if (options.type === "success") {
          icon.innerHTML = "✓";
          icon.className = "custom-alert-icon success-checkmark";
        } else if (options.type === "info") {
          icon.innerHTML = "ℹ";
          icon.className = "custom-alert-icon info-icon";
        }

        title.textContent = options.title || "Notification";
        message.textContent = options.message || "";

        if (options.steps && options.steps.length > 0) {
          stepsContainer.style.display = "block";
          stepsContainer.innerHTML = "";
          options.steps.forEach((step, index) => {
            const stepEl = document.createElement("div");
            stepEl.className = "custom-alert-step";
            stepEl.innerHTML = `
                        <div class="custom-alert-step-number">${index + 1}</div>
                        <div class="custom-alert-step-text">${step}</div>
                    `;
            stepsContainer.appendChild(stepEl);
          });
        } else {
          stepsContainer.style.display = "none";
        }

        overlay.classList.add("show");

        button.onclick = () => {
          hideCustomAlert();
          if (options.onClose) {
            options.onClose();
          }
        };

        overlay.onclick = (e) => {
          if (e.target === overlay) {
            hideCustomAlert();
            if (options.onClose) {
              options.onClose();
            }
          }
        };
      }

      function hideCustomAlert() {
        const overlay = document.getElementById("customAlertOverlay");
        overlay.classList.remove("show");
      }

      // Mobile detection
      function isMobile() {
        return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      }

      // Get image blob
      async function getImageBlob() {
        try {
          const response = await fetch(previewImage.src);
          const blob = await response.blob();
          return blob;
        } catch (error) {
          console.error("Error fetching image:", error);
          return null;
        }
      }

      // WEB SHARE API - ONLY ON MOBILE
      async function tryWebShareMobile() {
        // ONLY use on mobile devices where it actually shows social media apps
        if (!isMobile()) {
          return false; // Skip on desktop
        }

        if (!navigator.share || !navigator.canShare) {
          return false;
        }

        try {
          const blob = await getImageBlob();
          if (!blob) return false;

          const file = new File([blob], "icair-2025-dp.png", {
            type: "image/png",
          });

          const shareData = {
            title: "ICAIR 2025",
            text: SHARE_TEXT,
            files: [file],
          };

          if (navigator.canShare(shareData)) {
            await navigator.share(shareData);
            return true;
          }
        } catch (error) {
          if (error.name === "AbortError") {
            return true; // User cancelled, but API worked
          }
          console.log("Web Share API error:", error);
          return false;
        }

        return false;
      }

      uploadArea.addEventListener("click", () => {
        fileInput.click();
      });

      fileInput.addEventListener("change", (e) => {
        if (e.target.files.length > 0) {
          handleFile(e.target.files[0]);
        }
      });

      uploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadArea.classList.add("dragover");
      });

      uploadArea.addEventListener("dragleave", () => {
        uploadArea.classList.remove("dragover");
      });

      uploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
        if (e.dataTransfer.files.length > 0) {
          handleFile(e.dataTransfer.files[0]);
        }
      });

      function handleFile(file) {
        if (!file.type.startsWith("image/")) {
          showError("Please upload an image file");
          fileInput.value = "";
          return;
        }

        if (file.size > 16 * 1024 * 1024) {
          showError("File size must be less than 16MB");
          fileInput.value = "";
          return;
        }

        processImage(file);
      }

      async function processImage(file) {
        const username = usernameInput.value.trim();

        if (!username) {
          showError("Please enter your name");
          usernameInput.focus();
          fileInput.value = "";
          return;
        }

        hideError();
        usernameInput.parentElement.style.display = "none";
        uploadArea.style.display = "none";
        loading.classList.add("show");
        previewContainer.classList.remove("show");

        const formData = new FormData();
        formData.append("image", file);
        formData.append("username", username);

        try {
          const response = await fetch("/process-image", {
            method: "POST",
            body: formData,
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.error || "Failed to process image");
          }

          previewImage.src = data.image;
          loading.classList.remove("show");
          previewContainer.classList.add("show");

          document.getElementById("pageTitle").textContent =
            "Your Profile Picture is Ready!";
          document.getElementById("pageSubtitle").textContent =
            "Download your customized ICAIR 2025 profile picture";
        } catch (error) {
          console.error("Error:", error);
          showError(error.message);
          loading.classList.remove("show");
          uploadArea.style.display = "block";
        }
      }

      downloadBtn.addEventListener("click", () => {
        const link = document.createElement("a");
        link.href = previewImage.src;
        link.download = "icair-2025-dp.png";
        link.click();
      });

      resetBtn.addEventListener("click", () => {
        previewContainer.classList.remove("show");
        usernameInput.parentElement.style.display = "block";
        uploadArea.style.display = "block";
        fileInput.value = "";
        usernameInput.value = "";
        hideError();

        document.getElementById("pageTitle").textContent = "ICAIR 2025";
        document.getElementById("pageSubtitle").textContent =
          "Generate your conference profile picture";
      });

      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.classList.add("show");
      }

      function hideError() {
        errorMessage.classList.remove("show");
      }

      // TWITTER SHARING
      document
        .getElementById("shareTwitter")
        .addEventListener("click", async () => {
          // Try Web Share API on MOBILE ONLY
          if (await tryWebShareMobile()) {
            return; // Success on mobile!
          }

          // Desktop OR mobile fallback: Show custom dialog
          downloadBtn.click();
          await new Promise((resolve) => setTimeout(resolve, 500));

          let clipboardSuccess = false;
          try {
            await navigator.clipboard.writeText(SHARE_TEXT);
            clipboardSuccess = true;
          } catch (err) {
            console.log("Clipboard error:", err);
          }

          if (isMobile()) {
            const twitterAppUrl = `twitter://post?message=${encodeURIComponent(
              SHARE_TEXT
            )}`;
            const twitterWebUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(
              SHARE_TEXT
            )}`;

            showCustomAlert({
              type: "success",
              title: "Ready to Share!",
              message: clipboardSuccess
                ? "Image downloaded and caption copied!"
                : "Image downloaded.",
              steps: [
                "Attach the downloaded image to your tweet",
                clipboardSuccess
                  ? "Paste the caption (already copied!)"
                  : "Add the caption",
                "Tweet!",
              ],
              onClose: () => {
                window.location.href = twitterAppUrl;
                setTimeout(() => {
                  window.open(twitterWebUrl, "_blank");
                }, 500);
              },
            });
          } else {
            showCustomAlert({
              type: "success",
              title: "Ready to Share!",
              message: clipboardSuccess
                ? "Image downloaded and caption copied!"
                : "Image downloaded.",
              steps: [
                "Twitter will open in a new tab",
                "Click the image icon to attach your photo",
                clipboardSuccess
                  ? "Paste the caption (Cmd/Ctrl + V)"
                  : "Add the caption",
                "Tweet!",
              ],
              onClose: () => {
                window.open(
                  `https://twitter.com/intent/tweet?text=${encodeURIComponent(
                    SHARE_TEXT
                  )}`,
                  "_blank",
                  "width=550,height=420"
                );
              },
            });
          }
        });

      // LINKEDIN SHARING
      document
        .getElementById("shareLinkedIn")
        .addEventListener("click", async () => {
          // Try Web Share API on MOBILE ONLY
          if (await tryWebShareMobile()) {
            return;
          }

          // Desktop OR mobile fallback
          downloadBtn.click();
          await new Promise((resolve) => setTimeout(resolve, 500));

          let clipboardSuccess = false;
          try {
            await navigator.clipboard.writeText(SHARE_TEXT);
            clipboardSuccess = true;
          } catch (err) {
            console.log("Clipboard error:", err);
          }

          if (isMobile()) {
            showCustomAlert({
              type: "success",
              title: "Ready to Share!",
              message: clipboardSuccess
                ? "Image downloaded and caption copied!"
                : "Image downloaded.",
              steps: [
                'Tap "+" to create a post',
                "Attach your downloaded image",
                clipboardSuccess ? "Paste the caption" : "Add the caption",
                "Post!",
              ],
              onClose: () => {
                window.location.href = "linkedin://";
                setTimeout(() => {
                  window.open("https://www.linkedin.com/", "_blank");
                }, 500);
              },
            });
          } else {
            showCustomAlert({
              type: "success",
              title: "Ready to Share!",
              message: clipboardSuccess
                ? "Image downloaded and caption copied!"
                : "Image downloaded.",
              steps: [
                "LinkedIn will open in a new tab",
                'Click "Start a post"',
                "Click the image icon and attach your photo",
                clipboardSuccess
                  ? "Paste the caption (Cmd/Ctrl + V)"
                  : "Add the caption",
                "Post!",
              ],
              onClose: () => {
                window.open("https://www.linkedin.com/", "_blank");
              },
            });
          }
        });

      // INSTAGRAM SHARING
      document
        .getElementById("shareInstagram")
        .addEventListener("click", async () => {
          // Desktop - Instagram web doesn't allow posting
          if (!isMobile()) {
            showCustomAlert({
              type: "info",
              title: "Instagram on Mobile",
              message: "Instagram posting is only available on mobile devices.",
              steps: [
                "Transfer your image to your phone",
                "Open Instagram mobile app",
                "Create a new post",
                "Use the caption from this page",
              ],
            });
            return;
          }

          // Mobile: Try Web Share API
          if (await tryWebShareMobile()) {
            return;
          }

          // Mobile fallback
          downloadBtn.click();
          await new Promise((resolve) => setTimeout(resolve, 500));

          let clipboardSuccess = false;
          try {
            await navigator.clipboard.writeText(SHARE_TEXT);
            clipboardSuccess = true;
          } catch (err) {
            console.log("Clipboard error:", err);
          }

          showCustomAlert({
            type: "success",
            title: "Ready to Share!",
            message: clipboardSuccess
              ? "Image downloaded and caption copied!"
              : "Image downloaded.",
            steps: [
              'Tap "+" to create a new post',
              "Select your downloaded image",
              clipboardSuccess ? "Paste the caption" : "Add the caption",
              "Share!",
            ],
            onClose: () => {
              window.location.href = "instagram://";
              setTimeout(() => {
                window.open("https://www.instagram.com/", "_blank");
              }, 500);
            },
          });
        });
    </script>
  </body>
</html>
